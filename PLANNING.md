# PLANNING.md - 规划决策技术规范

> 15分钟Think Hard方法论的标准化实施，基于README.md 3.1.1-3.1.2节生成requirements.md+tech.md

## 时间分配规范

| 思考阶段 | 时间分配 | 输入规范 | 输出规范 | 验证标准 |
|----------|----------|----------|----------|----------|
| **需求澄清** | 5分钟 | CREATE.md需求 | requirements.md需求文档 | 评分>0.6 |
| **技术评估** | 4分钟 | ML.md框架矩阵 | tech.md技术选型 | 量化评分≥3.5 |
| **资源规划** | 3分钟 | ML.md硬件需求 | 资源配置计划 | GPU内存精确计算 |
| **时间设计** | 3分钟 | TASK.md任务模板 | 项目里程碑 | 100%任务覆盖 |

## 决策标准矩阵

### 框架选择评估（权重分配）
| 评估维度 | PyTorch | PaddlePaddle | 权重 | 选择阈值 |
|----------|---------|--------------|------|----------|
| **团队熟悉度** | ★★★★☆ | ★★★☆☆ | 0.30 | ≥3.5分 |
| **部署便利性** | ★★★☆☆ | ★★★★☆ | 0.25 | 通过标准 |
| **性能优化** | ★★★★☆ | ★★★★☆ | 0.25 | 量化评分 |
| **社区支持** | ★★★★★ | ★★★☆☆ | 0.20 | ≥2候选模型 |

### 模型架构决策
- **候选模型1**: YOLOv10n（轻量级，≤6GB显存）
- **候选模型2**: Faster R-CNN（精度优先，≥8GB显存）
- **输入规格**: 640×640 RGB图像，标准化预处理
- **输出规格**: 边界框+类别+置信度，80类COCO格式

## 资源评估公式

### GPU内存计算
```
GPU内存 = 模型参数 + 激活值 + 优化器状态 + 数据缓存
YOLOv10n: 3.5GB + 1.2GB + 7.0GB + 2.0GB = 13.7GB (50%安全余量)
```

### 训练时间估算
```
Epoch时间 = (数据量 / batch_size) × 单批次时间
COCO2017: 118k样本，batch=16，500ms/批次 → 1小时/epoch
```

## 输出模板

### requirements.md结构
```yaml
项目定义:
  名称: [英文项目名称]
  类型: [classification/detection/segmentation]
  场景: [详细使用场景]
  价值: [量化业务价值]

性能目标:
  准确率: mAP@0.5 ≥ 0.85
  速度: ≤200ms/张
  资源: ≤8GB GPU内存

约束条件:
  硬件: RTX 3060+，6GB+显存
  时间: 开发周期≤2周
  成本: 计算成本预算明确
```

### tech.md结构
```yaml
技术决策:
  主框架: [PyTorch/PaddlePaddle]
  量化评分: [≥3.5分计算过程]
  备选方案: [后备技术选型]

模型架构:
  候选模型: [≥2个具体模型]
  输入规格: [分辨率/通道/格式]
  输出规格: [类别数/格式要求]

资源评估:
  GPU需求: [精确内存计算]
  训练时间: [基于ML.md公式]
  成本优化: [资源配置策略]
```

## 验证清单

- [ ] 15分钟内完成系统化深度思考
- [ ] 每个技术决策都有ML.md量化依据
- [ ] 框架选择评分≥3.5分，≥2候选模型
- [ ] GPU内存计算精确，符合ML.md公式
- [ ] 输出完全符合requirements.md+tech.md模板

## 关键指标

- **决策质量**: 零技术债务（规范驱动）
- **时间效率**: 15分钟vs4-8小时经验决策
- **验证覆盖率**: 100%规范引用vs30-50%经验验证
- **可维护性**: 文档化决策vs隐性知识依赖

## 高层API架构

### 零样板设计原则
- **模型层**: LightningModule封装（≤150行）
- **数据层**: DataModule抽象（≤100行）
- **配置层**: OmegaConf驱动（YAML定义）
- **训练层**: Trainer自动处理（零手动代码）

### 配置驱动范式
- **主配置**: config.yaml（≤20行）
- **模型配置**: model/*.yaml（≤10行）
- **数据配置**: data/*.yaml（≤10行）
- **训练配置**: trainer/*.yaml（≤15行）

## 质量检查

- [ ] 需求澄清评分>0.6，所有条目量化明确
- [ ] 技术选型基于ML.md决策矩阵，有理有据
- [ ] 资源评估使用ML.md第2章精确计算公式
- [ ] 时间规划符合TASK.md第5章里程碑要求
- [ ] 输出规格完全符合README.md 3.1.1-3.1.2节标准

## 执行流程

```
第1步：需求澄清（5分钟）
- 问题定义→场景分析→成功标准
- 输出：requirements.md需求文档

第2步：技术评估（4分钟）
- 框架选择→模型架构→数据集计划
- 输出：tech.md技术选型

第3步：资源规划（3分钟）
- GPU内存计算→训练时间估算→成本评估
- 输出：资源配置计划

第4步：时间设计（3分钟）
- 任务分解→里程碑设定→验收标准
- 输出：项目时间线
```

## 技术约束

- **代码限制**: ≤200行高层API实现
- **框架支持**: PyTorch Lightning + PaddlePaddle
- **配置系统**: OmegaConf动态配置，层次化继承
- **验证标准**: 1-epoch快速验证，GPU利用率>90%