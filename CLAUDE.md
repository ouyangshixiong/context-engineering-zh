### 🔄 项目认知与上下文
- **始终在新对话开始时读取 `PLANNING.md`**，以理解项目的架构、目标、样式和约束。
- **在开始新任务前检查 `TASK.md`**。如果任务未列出，请添加简短描述和当天日期。
- **使用一致的命名约定、文件结构和架构模式**，如 `PLANNING.md` 中所述。
- **使用 Docker 进行项目部署**，支持 CPU 和 GPU 两种配置模式。

### 🧱 代码结构与模块化
- **绝不创建超过500行代码的文件。** 如果文件接近此限制，请通过拆分为模块或辅助文件进行重构。
- **将代码组织成清晰分离的模块**，按功能或职责分组。
  对于代理，结构如下：
    - `agent.py` - 主要代理定义和执行逻辑
    - `tools.py` - 代理使用的工具函数
    - `prompts.py` - 系统提示词
- **使用清晰、一致的导入**（优先使用包内的相对导入）。
- **使用清晰、一致的导入**（优先使用包内的相对导入）。
- **使用 python_dotenv 和 load_env()** 处理环境变量。
- **使用 Docker 部署时遵循以下结构**：
  - `deploy/cpu/` - CPU 专用 Docker 配置
  - `deploy/gpu/` - GPU 专用 Docker 配置
  - `deploy/shared/` - 共享部署脚本和工具

### 🧪 测试与可靠性
- **始终为新功能创建 Pytest 单元测试**（函数、类、路由等）。
- **更新任何逻辑后**，检查现有单元测试是否需要更新。如果需要，请进行更新。
- **测试应位于 `/tests` 文件夹**中，镜像主应用结构。
  - 至少包括：
    - 1个预期使用情况的测试
    - 1个边界情况测试
    - 1个失败情况测试
- **Docker 环境下的测试**：
  - 使用 `docker compose exec` 在容器中运行测试
  - 确保容器化环境与本地测试环境一致
  - 测试容器健康检查和启动脚本

### ✅ 任务完成
- **完成任务后立即在 `TASK.md` 中标记**。
- 将在开发过程中发现的新子任务或待办事项添加到 `TASK.md` 的"工作中发现"部分。
- **Docker 部署任务**：
  - 在 `deploy/README.md` 中记录部署配置变更
  - 更新 Docker 镜像版本标签
  - 记录 GPU 驱动和 CUDA 版本要求

### 📎 样式与约定
- **使用 Python** 作为主要语言。
- **遵循 PEP8**，使用类型提示，并用 black 格式化。
- **使用 `pydantic` 进行数据验证**。
- 如适用，使用 `FastAPI` 构建 API，使用 `SQLAlchemy` 或 `SQLModel` 作为 ORM。
- **为每个函数编写文档字符串**，使用 Google 样式：
  ```python
  def example():
      """
      简要总结。

      参数：
          param1 (类型): 描述。

      返回：
          类型: 描述。
      """
  ```
- **Docker 相关约定**：
  - 使用 `.dockerignore` 排除不必要的文件
  - 使用多阶段构建优化镜像大小
  - 使用健康检查确保服务可用性
  - 使用非 root 用户运行容器进程

### 📚 文档与可解释性
- **添加新功能、依赖变更或设置步骤修改时更新 `README.md`**。
- **注释不明显的代码**，确保中级开发者能够理解一切。
- 编写复杂逻辑时，**添加内联 `# 原因：` 注释**解释原因，而不仅仅是内容。
- **Docker 文档要求**：
  - 为每个部署配置添加 README.md
  - 记录环境变量和配置选项
  - 提供故障排除和常见问题解答

### 🧠 AI行为规则
- **绝不假设缺失的上下文。如有疑问，请提问。**
- **绝不虚构库或函数** - 仅使用已知、经验证的 Python 包。
- **始终在代码或测试中引用前确认文件路径和模块名称**存在。
- **绝不删除或覆盖现有代码**，除非明确指示或作为来自 `TASK.md` 的任务的一部分。
- **Docker 部署规则**：
  - 优先使用官方基础镜像
  - 固定版本号以确保可重现性
  - 最小化镜像体积和攻击面
  - 确保容器可移植性和安全性